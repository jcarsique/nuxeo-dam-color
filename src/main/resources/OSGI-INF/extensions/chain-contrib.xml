<?xml version="1.0"?>
<component name="org.nuxeo.demo.dam.color.chains">
    <extension target="org.nuxeo.ecm.core.operation.OperationServiceComponent" point="chains">
        <chain id="ExtractColor">
            <operation id="Context.FetchDocument"/>
            <operation id="Context.SetInputAsVar">
                <param type="string" name="name">doc</param>
            </operation>
            <operation id="Picture.GetView">
                <param type="string" name="viewName">Small</param>
            </operation>
            <operation id="Context.SetVar">
                <param type="string" name="name">fileName</param>
                <param type="object" name="value">expr:This.filename</param>
            </operation>
            <operation id="Blob.RunConverter">
                <param type="string" name="converter">ExtractColor</param>
                <param type="properties" name="parameters">expr:max=128
                    targetFileName=Colors-@{fileName}.txt
                </param>
            </operation>
            <operation id="Conversion.ProcessColorHistogramOp">
                <param type="document" name="documentModel">expr:Context["doc"]</param>
            </operation>
            <operation id="Context.RestoreDocumentInput">
                <param type="string" name="name">doc</param>
            </operation>
            <operation id="Document.Save"/>
        </chain>
        <chain id="Recompute">
            <operation id="Repository.Query">
                <param type="string" name="query">Select * From Picture Where ecm:isVersion = 0</param>
                <param type="string" name="language">NXQL</param>
                <param type="integer" name="pageSize">500</param>
                <param type="string" name="sortOrder">ASC</param>
            </operation>
            <operation id="Event.Fire">
                <param type="string" name="name">pictureViewsGenerationDone</param>
            </operation>
        </chain>
    </extension>
</component>
